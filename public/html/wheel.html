<!DOCTYPE html>
<html>
<head lang="en">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Datetime Picker</title>

    <script type="text/javascript"
            src="../js/jquery-1.11.2.js"></script>
    <script type="text/javascript"
            src="../js/jquery-ui-core.js"></script>
    <script type="text/javascript"
            src="../js/hammer.js"></script>

    <style type="text/css">
        html, body {
            height: 100%;
            margin: 0;
        }

        .wheel {
            position: relative;
            width: 100px;
            height: 150px;
            border: 5px solid #888;
            margin: 150px;
            overflow: hidden;
        }

        table.cards {
            height: 500%;
            width: 100%;
            top: -200%;
            position: absolute;
            padding: 0;
            margin: 0;
            border: 0;
            table-layout: fixed;
            border-collapse: collapse;
        }

        td.card {
            width: 100%;
            text-align: center;
            border: 0;
            padding: 0;
        }

        table.cards tr:nth-child(2n) .card {
            background: #e8e8e8;
        }
    </style>
</head>
<body>

<script type="text/javascript">
    (function (window, document, exportName, undefined) {
        Math.easeInOutQuad = function (t, b, c, d) {
            t /= d / 2;
            if (t < 1) return c / 2 * t * t + b;
            t--;
            return -c / 2 * (t * (t - 2) - 1) + b;
        };

        function Wheel(element, options) {
            this.element = element;
            this.options = options || {};
            this.values = this.options.values;
            this.index = Math.floor(this.values.length / 2);
            this.init();
        }

        Wheel.prototype = {
            size: 15,
            direction: null,
            init: function () {
                var wheel = document.createElement('div');
                wheel.className = 'wheel';
                this.element.appendChild(wheel);

                //var wheel = $('<div>').addClass('wheel').appendTo(this.element);
                var cards = $('<table>').addClass('cards').appendTo(wheel);
                for (var i = 0; i < 15; i++) {
                    var tr = $('<tr>').appendTo(cards);
                    $('<td>').addClass('card').appendTo(tr);
                }
                this.cards = cards.get(0);
                this.updateView();
            },
            updateIndex: function (index) {
                this.index = index;
            },
            updateValues: function (values) {
                this.values = values;
                this.index = this.index || 0;
            },
            wheelUp: function (val) {
                // stop any previous wheeling
                clearTimeout(this.timer);
                this.timer = null;

                // recalculate these values in case height change

                this.cardHeight = this.cards.clientHeight / this.size;
                this.top = this.cards.offsetTop;
                // default half hidden height
                this.HHH = this.cardHeight * (this.size - 3) / 2;

                var targetTop = val * -1 * this.cardHeight - this.HHH;
                var delta = Math.abs(targetTop - this.cards.offsetTop);
                var dir = targetTop < this.cards.offsetTop ? -1 : 1;

//                console.log(delta, dir);
//
                if (val > 0) {
                    this._scroll(0, delta, dir, true);
                } else {
                    this._scroll(0, delta, dir, true);
                }
            },
            _scroll: function (delta, total, dir, first) {
                var dy = Math.floor(Math.pow(delta * 200 / total, .5)) + 1;
                dy = Math.min(dy, total - delta);
                console.log(dy);
                delta += dy;
                this.top += dir * dy;

                if (this.top > 0) {
                    this.top -= this.HHH;
                    this.index = this.getIndex();
                    this.updateView();
                } else if (this.top < this.HHH * -2) {
                    this.top += this.HHH;
                    this.index = this.getIndex();
                    this.updateView();
                }

                this.cards.style.top = this.top + 'px';

                if (delta == total) {
                    this._finish();
                    return;
                }

                // stopped by another call
                if (this.timer == null && !first) return;

                var that = this;
                this.timer = setTimeout(function () {
                    that._scroll(delta, total, dir);
                }, 10);
            },
            _finish: function () {
                this.index = this.getIndex();
                this.cards.style.top = -this.HHH + 'px';
                this.updateView();
            },
            getIndex: function () {
                var delta = this.cards.offsetTop + this.HHH;
                var n = Math.floor(Math.abs(delta) / this.cardHeight + .5);
                return this.index + n * (delta > 0 ? -1 : 1);
            },
            updateView: function () {
                var tds = findByTagName(this.cards, 'td');
                var diff = Math.floor(this.size / 2);
                var idx = this.index;
                var arr = this.options.values;
                each(tds, function (td, i) {
                    td.innerText = arr[(idx + i - diff) % arr.length];
                });
            }
        };

        function findByTagName(element, tagName) {
            tagName = tagName.toLowerCase();
            var stack = [element], results = [];
            var childNodes, i, el, c;
            while (stack.length > 0) {
                el = stack.shift();
                childNodes = el.childNodes;
                for (i = 0; i < childNodes.length; i++) {
                    c = childNodes[i];
                    stack.push(c);
                    if (c.nodeName.toLowerCase() === tagName)
                        results.push(c);
                }
            }
            return results;
        }

        function each(obj, iterator, context) {
            var i;
            if (!obj) return;
            if (obj.forEach) {
                obj.forEach(iterator, context);
            } else if (obj.length !== undefined) {
                i = 0;
                while (i < obj.length) {
                    iterator.call(context, obj[i], i, obj);
                    i++;
                }
            } else {
                for (i in obj) {
                    obj.hasOwnProperty(i) && iterator.call(context, obj[i], i, obj);
                }
            }
        }

        window.Wheel = Wheel;
    })(window, document, 'Wheel');


    var years = [];
    for (var i = 0; i < 100; i++) {
        years.push(i + 2015 - 50);
    }

    var w = new Wheel(document.body, {
        values: years,
        delta: 100,
        step: 1
    });

    setTimeout(function () {
        w.wheelUp(10);
    }, 1000);
</script>
</body>
</html>